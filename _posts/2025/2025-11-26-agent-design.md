---
title: 多 Agent 架构的深度演进与设计范式
categories: Tech
tags: database, ai
date: 2025-11-26
---

大模型（LLM）的应用开发正在经历一场静悄悄的范式转移：**从 Prompt Engineering（提示词工程）转向 Flow Engineering（工作流工程）。**

过去两年，我们试图通过无限优化 Prompt 来挖掘单个模型的潜力。但我们逐渐触碰到了“单体智能”的天花板——上下文窗口的限制、推理深度的衰减、以及多领域知识的干扰。

破局之道，在于**多 Agent 架构 (Multi-Agent Architecture)**。这不仅仅是堆砌多个 LLM，而是像设计人类组织一样，设计智能体的拓扑结构。

本文将剥离炒作，深入探讨多 Agent 系统的核心设计范式。

---

### 一、 为什么需要多 Agent？（The "Why"）

单体 LLM 本质上是一个概率预测机，倾向于“快思考”（System 1）。而多 Agent 架构通过**分工**与**协作**，强制系统进入“慢思考”（System 2）。

其核心价值在于**“解耦” (Decoupling)**：
1.  **上下文解耦：** 只要 Worker A 不需要知道 Worker B 的任务细节，我们就能节省大量的 Token，避免大海捞针。
2.  **能力解耦：** 让擅长写 SQL 的 Agent 只写 SQL，擅长写文案的 Agent 只写文案。专业的人做专业的事。
3.  **幻觉抑制：** 通过“执行者”与“审查者”的对抗/协作，通过多视角的交叉验证，显著降低幻觉。

---

### 二、 微观范式：Agent 的原子能力

在讨论宏观架构前，我们先看构成系统的最小单元——单个 Agent 的运作模式。

1.  **PEER (Plan-Execute-Express-Review)：**
    * **定义：** 这是 Agent 的“内功”。通过 PDCA 循环，赋予 Agent 自我修正的能力。
    * **价值：** 它是 Agent 从“鹦鹉”变成“工匠”的关键。没有 Review 的 Agent 是不可靠的。
2.  **DITR (Do It Then Review)：**
    * **定义：** 一种“先做后改”的后处理策略。利用 LLM “判别能力 > 生成能力”的特性。
    * **价值：** 它是提升输出质量性价比最高的手段，常用于单节点的产出优化。

---

### 三、 宏观范式：组织架构的拓扑学

多 Agent 系统的灵魂，在于 Agent 之间的连接方式。目前业界沉淀出三种主流的拓扑结构：

#### 1. 层级/监督模式 (Hierarchical Supervisor)
* **隐喻：** 公司组织架构（经理与专员）。
* **机制：** 设置一个 Supervisor（大脑）维护全局状态（State），根据当前进展，动态路由到具体的 Worker（手脚）。Worker 执行完后，将结果返回给 Supervisor，不直接与其他 Worker 交互。
* **适用场景：** 复杂工程任务（如全栈开发、大型代码评审）。
* **评价：** **最稳健**的架构。它解决了长程任务中上下文迷失的问题，因为 Supervisor 只保留摘要，Worker 只处理局部。

#### 2. 流水线融合模式 (Sequential Fusion) —— 以 DOE 为例
* **隐喻：** 精密装配线。
* **机制：** 针对高精度、高专业度内容生成，业界（如 agentUniverse）提出了 **DOE (Data-fining, Opinion-inject, Express)** 模式：
    * **D (Data-fining)：** 专注于客观数据的清洗与校准（去幻觉）。
    * **O (Opinion-inject)：** 专注于专家观点、SOP 或业务逻辑的注入（提深度）。
    * **E (Express)：** 专注于将 D 和 O 融合，进行人性化表达（做对齐）。
* **适用场景：** 研报生成、金融分析、严肃新闻写作。
* **评价：** 解决了“既要准确又要深度”的难题，实现了**数据理性与逻辑感性**的分离与重组。

#### 3. 协作研讨模式 (Joint Collaboration)
* **隐喻：** 圆桌会议 / 头脑风暴。
* **机制：** 多个 Agent 共享上下文，轮流发言或自由辩论。例如 AutoGen 的 Group Chat。
* **适用场景：** 创意生成、对抗性模拟（红蓝军演习）、开放式问题求解。
* **评价：** **涌现能力**最强，但最不可控，Token 消耗最大。工业落地需谨慎。

---

### 四、 核心挑战：状态管理 (State Management)

多 Agent 开发的本质，其实是**状态机的设计**。

在使用 LangGraph 或 AutoGen 等框架时，开发者面临的最大挑战不是 Prompt 怎么写，而是：**Agent 之间如何共享记忆？**

* **隔离派：** 每个 Agent 只有自己的短期记忆。这最节省资源，适合层级模式。
* **共享派：** 所有 Agent 读写同一个“黑板”（Blackboard）。这适合协作模式，但容易导致上下文爆炸。

**最佳实践：** 采用**“有限状态图” (Finite State Graph)**。定义清晰的 `State Schema`（数据结构），规定哪些数据是全局追加的（如 `logs`），哪些是局部覆盖的（如 `current_task`）。

---

### 五、 结语：Flow is All You Need

AI 应用开发的下半场，竞争的不是谁的模型参数更大，而是谁的**架构设计更精妙**。

未来的开发者，实际上是**组织架构设计师**。我们需要根据业务场景（是追求创意的发散，还是追求精度的收敛），灵活组合 **PEER 的个体能力**与 **DOE 的流水线工艺**，在 **Supervisor 的调度**下，构建出具备“群体智能”的数字团队。

不要只做一个 Prompt Engineer，去成为一名 **Flow Engineer**。
